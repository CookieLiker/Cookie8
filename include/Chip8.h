#pragma once

#include <array>
#include <cstdint>

using u8 = std::uint8_t;
using u16 = std::uint16_t;

namespace Cookie8
{
class Chip8
{
  private:
    static const unsigned int WIDTH = 64;
    static const unsigned int HEIGHT = 32;

    // Memory
    std::array<u8, 0x1000> RAM = {0};
    std::array<u16, 0x10> stack = {0};

    // Registers
    std::array<u8, 0x10> V = {0};
    u16 PC = 0x0000;
    u16 I = 0x0000;
    u8 SP = 0x00;
    u8 DT = 0x00;
    u8 ST = 0x00;

    // Keyboard
    std::array<bool, 0x10> keys = {0};

    // Display
    std::array<bool, WIDTH *HEIGHT> framebuffer = {0};

    // NumberSprites
    std::array<u8, 0x10 * 5> font{
        0xF0, 0x90, 0x90, 0x90, 0xF0, // 0
        0x20, 0x60, 0x20, 0x20, 0x70, // 1
        0xF0, 0x10, 0xF0, 0x80, 0xF0, // 2
        0xF0, 0x10, 0xF0, 0x10, 0xF0, // 3
        0x90, 0x90, 0xF0, 0x10, 0x10, // 4
        0xF0, 0x80, 0xF0, 0x10, 0xF0, // 5
        0xF0, 0x80, 0xF0, 0x90, 0xF0, // 6
        0xF0, 0x10, 0x20, 0x40, 0x40, // 7
        0xF0, 0x90, 0xF0, 0x90, 0xF0, // 8
        0xF0, 0x90, 0xF0, 0x10, 0xF0, // 9
        0xF0, 0x90, 0xF0, 0x90, 0x90, // A
        0xE0, 0x90, 0xE0, 0x90, 0xE0, // B
        0xF0, 0x80, 0x80, 0x80, 0xF0, // C
        0xE0, 0x90, 0x90, 0x90, 0xE0, // D
        0xF0, 0x80, 0xF0, 0x80, 0xF0, // E
        0xF0, 0x80, 0xF0, 0x80, 0x80  // F
    };

    u16 Fetch();
    u16 Decode(u16 instruction);
    void Execute(u16 opcode);

  public:
    Chip8();
    void Step();
};
} // namespace Cookie8